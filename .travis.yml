os:
    - linux
    - osx

# OSX support is experimental. Expect failures
matrix:
  allow_failures:
    - os: osx

# 'bash' will define a generic environment without interfering environment
# settings like "CC=gcc"
language: bash

# Only build the master branch
branches:
    only:
        - master

# Caching the downloaded src packages between several builds to save travis-ci
# download time and bandwidth
cache:
    directories:
        - $HOME/src

# Installing needed dependencies
matrix:
    include:
        -os: linux
            # Using container-based infrastructure
            dist: trusty
            sudo: false

            addons:
                apt:
                    packages:
                        - bison
                        - flex
                        - gperf
                        - libncurses5-dev
                        - texinfo
                        - help2man
                        - g++

        -os: osx
            before_install:
                - brew update
                - brew install autoconf
                - brew install binutils
                - brew install gawk
                - brew install gmp
                - brew install gnu-sed
                - brew install help2man
                - brew install mpfr
                - brew install openssl
                - brew install pcre
                - brew install readline
                - brew install wget
                - brew install xz


# Building crosstool-NG core
install:
    - ./bootstrap
    - ./configure --enable-local
    - make

# Here is the list of all the standard samples tracked
# by the continuous integration system
env:
    - CT_SAMPLE=arm-unknown-eabi
    - CT_SAMPLE=arm-unknown-linux-musleabi
    - CT_SAMPLE=aarch64-unknown-linux-gnueabi
    - CT_SAMPLE=mips64el-multilib-linux-uclibc
    - CT_SAMPLE=powerpc-e500v2-linux-gnuspe
    - CT_SAMPLE=x86_64-unknown-linux-uclibc
    - CT_SAMPLE=xtensa-fsf-linux-uclibc

# Building the standard samples
script:
    - . ./.travis.sh      # Load the travis environment
    - ct-ng $CT_SAMPLE    # Configure the build
    - ct-ng_travis_build  # Build the sample

# On failure displaying the last lines of the log file
after_failure:
    - tail -n 1000 build.log
