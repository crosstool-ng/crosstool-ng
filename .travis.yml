# Using container-based infrastructure
sudo: false

# 'bash' will define a generic environment without interfering environment
# settings like "CC=gcc"
language: bash

# Only build the master branch
branches:
    only:
        - master

# Caching the downloaded src packages between several builds to save travis-ci
# download time and bandwidth
cache:
    directories:
        - $HOME/src

# Installing needed dependencies
addons:
    apt:
        packages:
            - bison
            - flex
            - gperf
            - libncurses5-dev
            - texinfo

# Building crosstool-NG core
install:
    - ./bootstrap
    - ./configure --enable-local
    - make

# Here is the list of all the standard samples tracked
# by the continuous integration system
env:
    - CT_SAMPLE=alphaev56-unknown-linux-gnu
    - CT_SAMPLE=alphaev67-unknown-linux-gnu
    - CT_SAMPLE=arm-bare_newlib_cortex_m3_nommu-eabi
    - CT_SAMPLE=arm-cortex_a15-linux-gnueabi
    - CT_SAMPLE=arm-cortexa5-linux-uclibcgnueabihf
    - CT_SAMPLE=arm-cortex_a8-linux-gnueabi
    - CT_SAMPLE=arm-cortexa9_neon-linux-gnueabihf
    - CT_SAMPLE=armeb-unknown-eabi
    - CT_SAMPLE=armeb-unknown-linux-gnueabi
    - CT_SAMPLE=armeb-unknown-linux-uclibcgnueabi
    - CT_SAMPLE=arm-unknown-eabi
    - CT_SAMPLE=arm-unknown-linux-gnueabi
    - CT_SAMPLE=arm-unknown-linux-uclibcgnueabi
    - CT_SAMPLE=arm-unknown-linux-uclibcgnueabihf
    - CT_SAMPLE=armv6-rpi-linux-gnueabi
    - CT_SAMPLE=armv7-rpi2-linux-gnueabihf
    - CT_SAMPLE=avr
    - CT_SAMPLE=avr32-unknown-none
    - CT_SAMPLE=bfin-unknown-linux-uclibc
    - CT_SAMPLE=i586-geode-linux-uclibc
    - CT_SAMPLE=i686-nptl-linux-gnu
    - CT_SAMPLE=i686-w64-mingw32
    - CT_SAMPLE=m68k-unknown-elf
    - CT_SAMPLE=m68k-unknown-uclinux-uclibc
    - CT_SAMPLE=mips64el-n32-linux-uclibc
    - CT_SAMPLE=mips64el-n64-linux-uclibc
    - CT_SAMPLE=mips-ar2315-linux-gnu
    - CT_SAMPLE=mipsel-sde-elf
    - CT_SAMPLE=mipsel-unknown-linux-gnu
    - CT_SAMPLE=mips-malta-linux-gnu
    - CT_SAMPLE=mips-unknown-elf
    - CT_SAMPLE=mips-unknown-linux-uclibc
    - CT_SAMPLE=powerpc-405-linux-gnu
    - CT_SAMPLE=powerpc64-unknown-linux-gnu
    - CT_SAMPLE=powerpc-860-linux-gnu
    - CT_SAMPLE=powerpc-e300c3-linux-gnu
    - CT_SAMPLE=powerpc-e500v2-linux-gnuspe
    - CT_SAMPLE=powerpc-unknown-linux-gnu
    - CT_SAMPLE=powerpc-unknown_nofpu-linux-gnu
    - CT_SAMPLE=s390-ibm-linux-gnu
    - CT_SAMPLE=s390x-ibm-linux-gnu
    - CT_SAMPLE=sh4-unknown-linux-gnu
    - CT_SAMPLE=sparc-unknown-linux-gnu
    - CT_SAMPLE=x86_64-unknown-linux-gnu
    - CT_SAMPLE=x86_64-unknown-linux-uclibc
    - CT_SAMPLE=x86_64-w64-mingw32

# Building the standard samples
script:
    - . ./.travis.sh      # Load the travis environment
    - ct-ng $CT_SAMPLE    # Configure the build
    - ct-ng_travis_build  # Build the sample

# On failure displaying the last lines of the log file
after_failure:
    - tail -n 1000 build.log
